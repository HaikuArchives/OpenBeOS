<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>/cvsroot/OpenBeOS/storage_kit/source/lib/Path.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.1 on Sat Feb 23 17:20:30 2002 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>/cvsroot/OpenBeOS/storage_kit/source/lib/Path.cpp</h1><div class="fragment"><pre>00001 <font class="comment">//----------------------------------------------------------------------</font>
00002 <font class="comment">//  This software is part of the OpenBeOS distribution and is covered </font>
00003 <font class="comment">//  by the OpenBeOS license.</font>
00004 <font class="comment">//</font>
00005 <font class="comment">//  File Name: Path.cpp</font>
00006 <font class="comment">//  Description: An absolute pathname wrapper class</font>
00007 <font class="comment">//---------------------------------------------------------------------</font>
00008 <font class="preprocessor">#include "Path.h"</font>
00009 <font class="preprocessor">#include "Error.h"</font>
00010 
00011 <font class="preprocessor">#ifdef USE_OPENBEOS_NAMESPACE
</font>00012 <font class="preprocessor"></font><font class="keyword">using</font> <font class="keyword">namespace</font> OpenBeOS;
00013 <font class="preprocessor">#endif
</font>00014 <font class="preprocessor"></font>
00015 <font class="preprocessor">#define B_REF_TYPE 0
</font>00016 <font class="preprocessor"></font>
<a name="l00017"></a><a class="code" href="class_BPath.html#a29">00017</a> <font class="keywordtype">bool</font> <a class="code" href="class_BPath.html#a29">BPath::MustNormalize</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *path)<font class="keyword"> </font>{
00018     <font class="comment">// Check for useless input</font>
00019     <font class="keywordflow">if</font> (path == NULL)
00020         <font class="keywordflow">throw</font> <font class="keyword">new</font> EBadPathInput(<font class="stringliteral">"NULL path input"</font>);
00021     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (path[0] == 0)
00022         <font class="keywordflow">throw</font> <font class="keyword">new</font> EBadPathInput(<font class="stringliteral">"Empty path input"</font>);
00023         
00024     <font class="keywordtype">int</font> len = strlen(path); 
00025         
00026     <font class="comment">/* Look for anything in the string that forces us to normalize:
</font>00027 <font class="comment">            + No leading /
</font>00028 <font class="comment">            + A leading ./ or ../
</font>00029 <font class="comment">            + any occurence of /./ or /../ or //, or a trailing /. or /..
</font>00030 <font class="comment">            + a trailing /
</font>00031 <font class="comment">    */</font>;
00032     <font class="keywordflow">if</font> (path[0] != <font class="charliteral">'/'</font>)
00033         <font class="keywordflow">return</font> <font class="keyword">true</font>;    <font class="comment">//  "/*"</font>
00034     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (len &gt;= 2 &amp;&amp; path[0] == <font class="charliteral">'.'</font> &amp;&amp; path[1] == <font class="charliteral">'/'</font>)
00035         <font class="keywordflow">return</font> <font class="keyword">true</font>;    <font class="comment">//  "./*"</font>
00036     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (len &gt;= 3 &amp;&amp; path[0] == <font class="charliteral">'.'</font> &amp;&amp; path[1] == <font class="charliteral">'.'</font> &amp;&amp; path[2] == <font class="charliteral">'/'</font>)
00037         <font class="keywordflow">return</font> <font class="keyword">true</font>;    <font class="comment">//  "../*"</font>
00038     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (len &gt; 0 &amp;&amp; path[len-1] == <font class="charliteral">'/'</font>)
00039         <font class="keywordflow">return</font> <font class="keyword">true</font>;    <font class="comment">//  "*/"</font>
00040     <font class="keywordflow">else</font> {
00041         <font class="keyword">enum</font> ParseState {
00042             NoMatch,
00043             InitialSlash,
00044             OneDot,
00045             TwoDots
00046         } state = NoMatch;
00047         
00048         <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i = 0; path[i] != 0; i++) {
00049             <font class="keywordflow">switch</font> (state) {
00050                 <font class="keywordflow">case</font> NoMatch:
00051                     <font class="keywordflow">if</font> (path[i] == <font class="charliteral">'/'</font>)
00052                         state = InitialSlash;
00053                     <font class="keywordflow">break</font>;
00054                 
00055                 <font class="keywordflow">case</font> InitialSlash:
00056                     <font class="keywordflow">if</font> (path[i] == <font class="charliteral">'/'</font>)
00057                         <font class="keywordflow">return</font> <font class="keyword">true</font>;        <font class="comment">// "*//*"</font>
00058                     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (path[i] == <font class="charliteral">'.'</font>)
00059                         state = OneDot;
00060                     <font class="keywordflow">else</font>
00061                         state = NoMatch;
00062                     <font class="keywordflow">break</font>;
00063                 
00064                 <font class="keywordflow">case</font> OneDot:
00065                     <font class="keywordflow">if</font> (path[i] == <font class="charliteral">'/'</font>)
00066                         <font class="keywordflow">return</font> <font class="keyword">true</font>;        <font class="comment">// "*/./*"</font>
00067                     <font class="keywordflow">else</font> <font class="keywordflow">if</font> (path[i] == <font class="charliteral">'.'</font>)
00068                         state = TwoDots;
00069                     <font class="keywordflow">else</font>
00070                         state = NoMatch;
00071                     <font class="keywordflow">break</font>;
00072                     
00073                 <font class="keywordflow">case</font> TwoDots:
00074                     <font class="keywordflow">if</font> (path[i] == <font class="charliteral">'/'</font>)
00075                         <font class="keywordflow">return</font> <font class="keyword">true</font>;        <font class="comment">// "*/../*"</font>
00076                     <font class="keywordflow">else</font>
00077                         state = NoMatch;
00078                     <font class="keywordflow">break</font>;                      
00079             }
00080         }
00081         <font class="comment">// If we hit the end of the string while in either</font>
00082         <font class="comment">// of these two states, there was a trailing /. or /..</font>
00083         <font class="keywordflow">if</font> (state == OneDot || state == TwoDots)
00084             <font class="keywordflow">return</font> <font class="keyword">true</font>;
00085         <font class="keywordflow">else</font>
00086             <font class="keywordflow">return</font> <font class="keyword">false</font>;           
00087     }
00088     
00089 }
00090 
<a name="l00091"></a><a class="code" href="class_BPath.html#a0">00091</a> <a class="code" href="class_BPath.html#a0">BPath::BPath</a>() : fName(NULL) {
00092 }
00093     
<a name="l00094"></a><a class="code" href="class_BPath.html#a1">00094</a> <a class="code" href="class_BPath.html#a0">BPath::BPath</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *dir, <font class="keyword">const</font> <font class="keywordtype">char</font> *leaf = NULL, <font class="keywordtype">bool</font> normalize = <font class="keyword">false</font>)<font class="keyword"> </font>{
00095 }
00096     
<a name="l00097"></a><a class="code" href="class_BPath.html#a2">00097</a> <a class="code" href="class_BPath.html#a0">BPath::BPath</a>(<font class="keyword">const</font> BDirectory *dir, <font class="keyword">const</font> <font class="keywordtype">char</font> *leaf, <font class="keywordtype">bool</font> normalize = <font class="keyword">false</font>)<font class="keyword"> </font>{
00098 }
00099 
<a name="l00100"></a><a class="code" href="class_BPath.html#a3">00100</a> <a class="code" href="class_BPath.html#a0">BPath::BPath</a>(<font class="keyword">const</font> <a class="code" href="class_BPath.html">BPath</a> &amp;path)<font class="keyword"> </font>{
00101 }
00102 
<a name="l00103"></a><a class="code" href="class_BPath.html#a4">00103</a> <a class="code" href="class_BPath.html#a0">BPath::BPath</a>(<font class="keyword">const</font> BEntry *entry)<font class="keyword"> </font>{
00104 }
00105 
<a name="l00106"></a><a class="code" href="class_BPath.html#a5">00106</a> <a class="code" href="class_BPath.html#a0">BPath::BPath</a>(<font class="keyword">const</font> entry_ref *ref)<font class="keyword"> </font>{
00107 }
00108 
<a name="l00109"></a><a class="code" href="class_BPath.html#a6">00109</a> <a class="code" href="class_BPath.html#a6">BPath::~BPath</a>()<font class="keyword"> </font>{
00110 }
00111 
00112 
00113 
<a name="l00114"></a><a class="code" href="class_BPath.html#a7">00114</a> status_t <a class="code" href="class_BPath.html#a7">BPath::InitCheck</a>()<font class="keyword"> const </font>{
00115 }
00116 
<a name="l00117"></a><a class="code" href="class_BPath.html#a8">00117</a> status_t <a class="code" href="class_BPath.html#a8">BPath::SetTo</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *path, <font class="keyword">const</font> <font class="keywordtype">char</font> *leaf = NULL, <font class="keywordtype">bool</font> normalize = <font class="keyword">false</font>)<font class="keyword"> </font>{
00118 }
00119     
<a name="l00120"></a><a class="code" href="class_BPath.html#a9">00120</a> status_t <a class="code" href="class_BPath.html#a8">BPath::SetTo</a>(<font class="keyword">const</font> BDirectory *dir, <font class="keyword">const</font> <font class="keywordtype">char</font> *path, <font class="keywordtype">bool</font> normalize = <font class="keyword">false</font>)<font class="keyword"> </font>{
00121 }
00122     
<a name="l00123"></a><a class="code" href="class_BPath.html#a10">00123</a> status_t <a class="code" href="class_BPath.html#a8">BPath::SetTo</a>(<font class="keyword">const</font> BEntry *entry)<font class="keyword"> </font>{
00124 }
00125     
<a name="l00126"></a><a class="code" href="class_BPath.html#a11">00126</a> status_t <a class="code" href="class_BPath.html#a8">BPath::SetTo</a>(<font class="keyword">const</font> entry_ref *ref)<font class="keyword"> </font>{
00127 }
00128 
<a name="l00129"></a><a class="code" href="class_BPath.html#a12">00129</a> status_t <a class="code" href="class_BPath.html#a12">BPath::Append</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *path, <font class="keywordtype">bool</font> normalize = <font class="keyword">false</font>)<font class="keyword"> </font>{
00130 }
00131     
<a name="l00132"></a><a class="code" href="class_BPath.html#a13">00132</a> <font class="keywordtype">void</font> <a class="code" href="class_BPath.html#a13">BPath::Unset</a>()<font class="keyword"> </font>{
00133 }
00134     
<a name="l00135"></a><a class="code" href="class_BPath.html#a14">00135</a> <font class="keyword">const</font> <font class="keywordtype">char</font> *<a class="code" href="class_BPath.html#a14">BPath::Path</a>()<font class="keyword"> const </font>{
00136 }
00137     
<a name="l00138"></a><a class="code" href="class_BPath.html#a15">00138</a> <font class="keyword">const</font> <font class="keywordtype">char</font> *<a class="code" href="class_BPath.html#a15">BPath::Leaf</a>()<font class="keyword"> const </font>{
00139 }
00140 
<a name="l00141"></a><a class="code" href="class_BPath.html#a16">00141</a> status_t <a class="code" href="class_BPath.html#a16">BPath::GetParent</a>(<a class="code" href="class_BPath.html">BPath</a> *)<font class="keyword"> const </font>{
00142 }
00143     
<a name="l00144"></a><a class="code" href="class_BPath.html#a17">00144</a> <font class="keywordtype">bool</font> <a class="code" href="class_BPath.html#a17">BPath::operator==</a>(<font class="keyword">const</font> <a class="code" href="class_BPath.html">BPath</a> &amp;item)<font class="keyword"> const </font>{
00145 }
00146 
<a name="l00147"></a><a class="code" href="class_BPath.html#a18">00147</a> <font class="keywordtype">bool</font> <a class="code" href="class_BPath.html#a17">BPath::operator==</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *path)<font class="keyword"> const </font>{
00148 }
00149 
<a name="l00150"></a><a class="code" href="class_BPath.html#a19">00150</a> <font class="keywordtype">bool</font> <a class="code" href="class_BPath.html#a19">BPath::operator!=</a>(<font class="keyword">const</font> <a class="code" href="class_BPath.html">BPath</a> &amp;item)<font class="keyword"> const </font>{
00151 }
00152 
<a name="l00153"></a><a class="code" href="class_BPath.html#a20">00153</a> <font class="keywordtype">bool</font> <a class="code" href="class_BPath.html#a19">BPath::operator!=</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *path)<font class="keyword"> const </font>{
00154 }
00155     
00156 
<a name="l00157"></a><a class="code" href="class_BPath.html#a21">00157</a> <a class="code" href="class_BPath.html">BPath</a>&amp; <a class="code" href="class_BPath.html#a21">BPath::operator=</a>(<font class="keyword">const</font> <a class="code" href="class_BPath.html">BPath</a> &amp;item)<font class="keyword"> </font>{
00158 }
00159 
<a name="l00160"></a><a class="code" href="class_BPath.html#a22">00160</a> <a class="code" href="class_BPath.html">BPath</a>&amp; <a class="code" href="class_BPath.html#a21">BPath::operator=</a>(<font class="keyword">const</font> <font class="keywordtype">char</font> *path)<font class="keyword"> </font>{
00161 }
00162 
00163     
<a name="l00164"></a><a class="code" href="class_BPath.html#a23">00164</a> <font class="keywordtype">bool</font> <a class="code" href="class_BPath.html#a23">BPath::IsFixedSize</a>()<font class="keyword"> const </font>{
00165     <font class="keywordflow">return</font> <font class="keyword">false</font>;
00166 }
00167     
<a name="l00168"></a><a class="code" href="class_BPath.html#a24">00168</a> type_code <a class="code" href="class_BPath.html#a24">BPath::TypeCode</a>()<font class="keyword"> const </font>{
00169     <font class="keywordflow">return</font> B_REF_TYPE;
00170 }
00171     
<a name="l00172"></a><a class="code" href="class_BPath.html#a25">00172</a> ssize_t <a class="code" href="class_BPath.html#a25">BPath::FlattenedSize</a>()<font class="keyword"> const </font>{
00173     <font class="keywordflow">return</font> -1;
00174 }
00175     
<a name="l00176"></a><a class="code" href="class_BPath.html#a26">00176</a> status_t <a class="code" href="class_BPath.html#a26">BPath::Flatten</a>(<font class="keywordtype">void</font> *buffer, ssize_t size)<font class="keyword"> const </font>{
00177     <font class="keywordflow">return</font> B_ERROR;
00178 }
00179     
<a name="l00180"></a><a class="code" href="class_BPath.html#a27">00180</a> <font class="keywordtype">bool</font> <a class="code" href="class_BPath.html#a27">BPath::AllowsTypeCode</a>(type_code code)<font class="keyword"> const </font>{
00181     <font class="keywordflow">return</font> (code == B_REF_TYPE);
00182 }
00183     
<a name="l00184"></a><a class="code" href="class_BPath.html#a28">00184</a> status_t <a class="code" href="class_BPath.html#a28">BPath::Unflatten</a>(type_code c, <font class="keyword">const</font> <font class="keywordtype">void</font> *buf, ssize_t size)<font class="keyword"> </font>{
00185     <font class="keywordflow">return</font> B_ERROR;
00186 }
00187 
<a name="l00188"></a><a class="code" href="class_BPath.html#c0">00188</a> <font class="keywordtype">void</font> <a class="code" href="class_BPath.html#c0">BPath::_WarPath1</a>()<font class="keyword"> </font>{}
<a name="l00189"></a><a class="code" href="class_BPath.html#c1">00189</a> <font class="keywordtype">void</font> <a class="code" href="class_BPath.html#c1">BPath::_WarPath2</a>()<font class="keyword"> </font>{}
<a name="l00190"></a><a class="code" href="class_BPath.html#c2">00190</a> <font class="keywordtype">void</font> <a class="code" href="class_BPath.html#c2">BPath::_WarPath3</a>()<font class="keyword"> </font>{}
</div></pre><hr><address><small>Generated at Sat Feb 23 17:20:30 2002 for OpenBeOS Storage Kit by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
